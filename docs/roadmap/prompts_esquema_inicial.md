generar la configuraciÃ³n inicial de base de datos, modelos, migraciones y repositorios del proyecto.

# ðŸ“‹ Prompts for GitHub Copilot â€” Initial Schema and Migrations

This document collects **suggested prompts for GitHub Copilot in VS Code**, with the goal of generating the initial database configuration, models, migrations, and repositories for the project.

---

## Prompt 1 â€” DB Config and Session (engine, SessionLocal, Base)

```text
You are GitHub Copilot. Create a Python module `backend/app/db.py` that configures SQLAlchemy for a FastAPI project using Postgres.

Requirements:
- PEP8, internal variables/functions in camelCase.
- Read DATABASE_URL from environment (raise clear error if missing).
- Create `engine` with sensible pool settings for a small VPS:
  - pool_pre_ping=True, pool_size=5, max_overflow=5, pool_recycle=1800
- Create `SessionLocal = sessionmaker(...)` and `Base = declarative_base()`.
- Implement `getDb()` FastAPI dependency that yields a session and ensures close in a finally block.
- Add docstrings explaining each public symbol.
- Add typing annotations and a minimal logger for connection errors.
```

---

## Prompt 2 â€” SQLAlchemy Models (users, licenses, jobs, file_artifacts)

```text
You are GitHub Copilot. Implement SQLAlchemy models in `backend/app/models.py` for a transcription service.

Context:
- Using Postgres only. Prefer `JSONB` via `sqlalchemy.dialects.postgresql`.
- Import `Base` from app.db.

Models to create (with PEP8, camelCase internal attrs, docstrings):
1) User: id (UUID string), email unique/indexed, passwordHash, role, createdAt.
2) License: key PK, assignedToUserId (FK), plan, features JSONB, validFrom, validUntil, isRevoked, createdAt.
3) Job: id PK, ownerUserId FK, status, modelName, mode, language, audioDurationMs, processingTimeMs, resultJsonPath, transcriptTxtPath, createdAt, updatedAt, errorMessage.
4) FileArtifact: id PK, jobId FK, type, path, sizeBytes, createdAt, Unique(jobId,type).

Notes:
- Use `JSONB`.
- Relationships optional.
- Add __repr__ methods for debugging.
```

---

## Prompt 3 â€” Initialize Alembic and Link Metadata

```text
You are GitHub Copilot. Configure Alembic for this FastAPI project.

Tasks:
- Create `alembic.ini` with standard settings.
- Create `backend/alembic/` structure with `env.py`, `script.py.mako`, and `versions/`.
- In `env.py`:
  - Load DATABASE_URL from environment.
  - Import `Base` from `app.db` and set `target_metadata = Base.metadata`.
  - Support offline and online modes.
  - Enable compare_type=True and compare_server_default=True for autogenerate.
- Add a comment explaining how to run migrations.
```

---

## Prompt 4 â€” Initial Autogenerated Migration

```text
You are GitHub Copilot. Generate the initial Alembic migration file to create the schema defined in `backend/app/models.py`.

Requirements:
- Name the migration "init schema".
- Create tables: users, licenses, jobs, file_artifacts.
- Include PKs, FKs with ondelete, indices, composite index on jobs, unique (jobId,type).
- Use Postgres JSONB.
- Provide downgrade() that drops tables in dependency order.
- Add concise docstring.
```

---

## Prompt 5 â€” Repositories/services CRUD

```text
You are GitHub Copilot. Create repository modules under `backend/app/repos/`:
1) users_repo.py: create_user, get_user_by_email, get_user_by_id.
2) licenses_repo.py: upsert_license, get_license_by_key, assign_license_to_user.
3) jobs_repo.py: create_job, get_job_by_id, list_jobs_by_user, set_job_status.
4) artifacts_repo.py: add_artifact, list_artifacts_by_job, get_artifact_by_type.

Requirements:
- Use SQLAlchemy sessions from get_db().
- PEP8 (snake_case), type hints.
- Raise ValueError for invalid input, return objects or None.
- Keep functions small and documented.
```

---

## Prompt 6 â€” Pydantic Schemas and Test Endpoints

```text
You are GitHub Copilot. Implement Pydantic schemas in `backend/app/schemas.py` and a router in `backend/app/routers/jobs.py`.

Schemas:
- JobCreateIn, JobOut.

Router:
- Prefix `/api/transcriptions`.
- POST / create job.
- GET / list jobs by current user (status?, limit, offset).
- GET /{id} job detail.
- Use get_db().
- Minimal error handling.
```

---

## Prompt 7 â€” Health checks (API, Redis, DB)

```text
You are GitHub Copilot. Create a health router `backend/app/routers/health.py`.

Endpoints:
- GET /api/health â†’ checks DB (SELECT 1), Redis PING optional.
- Return JSON: {"dbOk": bool, "redisOk": bool, "version": <git sha or env>, "time": <epoch>}.
```

---

## Prompt 8 â€” Seed Demo Script

```text
You are GitHub Copilot. Write `backend/scripts/seed_demo.py`.
- Inserts demo admin and user.
- Adds 3 jobs for the user with statuses.
- Adds FileArtifact rows.
- Uses get_db().
- Print summary.
```

---

## Prompt 9 â€” Makefile targets Alembic/seed

```text
You are GitHub Copilot. Add Make targets:
- db-rev: alembic revision --autogenerate -m "$(m)"
- db-up: alembic upgrade head
- db-dn: alembic downgrade -1
- db-seed: python -m backend.scripts.seed_demo

Assumptions: Alembic under backend/alembic.
```
